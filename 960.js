/*! For license information please see 960.js.LICENSE.txt */
"use strict";(self.webpackChunkcoding_with_chrome=self.webpackChunkcoding_with_chrome||[]).push([[960],{414:(e,t,n)=>{n.d(t,{y:()=>o});var i=n(5671),r=n(3144),o=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"sep",value:function(){return"/"}},{key:"root",value:function(){return"/"}},{key:"delimiter",value:function(){return":"}},{key:"split",value:function(e){return e.startsWith("/")||console.error("Invalid absolute path."),["/"].concat(e.substr(1).split(this.sep()))}},{key:"resolve",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/",t=arguments.length>1?arguments[1]:void 0;return t.startsWith("/")?t:e+t.replace("./","/")}},{key:"closest",value:function(e,t){if(t.includes(e))return e;for(var n=e.lastIndexOf("/"),i=e.substring(0,n);n>0;){if(t.includes(i))return i;n=i.lastIndexOf("/"),i=i.substring(0,n)}return""}},{key:"dirname",value:function(e){return e.lastIndexOf("/")<=0?"/":e.substring(0,e.lastIndexOf("/"))}},{key:"basename",value:function(e){return e.substring(e.lastIndexOf("/")+1)}},{key:"parentDirname",value:function(e){return this.basename(this.dirname(e))}},{key:"findPathInObject",value:function(e,t){if(e.lastIndexOf("/")<=0&&e in t)return t[e]||null;for(var n=this.split(e),i=n.length,r=t,o=0;o<i;o++){if(!(n[o]in r))return null;r=r[n[o]]}return r}},{key:"join",value:function(){for(var e=this,t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];if(!n)return"";var r=[];return n.forEach((function(t){t.includes(e.sep())?Array.prototype.push.apply(r,t.split(e.sep())):r.push(t)})),this.normalize(r.join(this.sep()))}},{key:"normalize",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=e.split(this.sep()),n=e.startsWith(this.root());n&&t.splice(0,1),t.forEach((function(e,n){".."==e&&(t[n]="",void 0!==t[n-1]&&(t[n-1]=""))}));var i=[];t.forEach((function(e){e&&i.push(e)}));var r=i.join(this.sep());return n?this.root()+r:r}},{key:"isAbsolute",value:function(){return!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").startsWith(this.root())}}]),e}()},1600:(e,t,n)=>{n.d(t,{g:()=>u});var i=n(5671),r=n(3144),o=n(1024),s=n(669),u=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new o.X,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";(0,i.Z)(this,e),this.env=t||new o.X,this.terminal=n,this.process=s.uN.registerProcess(this),this.initialized=!1,this.registered=!1,this.name=r||"app".concat(Math.floor(9999*Math.random())),this.help="Usage: ".concat(this.name," [OPTION]... [ARGS]..."),this.version="1.0"}return(0,r.Z)(e,[{key:"initHandler",value:function(){return this.initialized||(console.debug("Initialize of ".concat(this.name," ...")),this.init(),this.initialized=!0),this}},{key:"init",value:function(){return this}},{key:"register",value:function(){this.registered=!0}},{key:"registerEnv",value:function(e){return this.env=e,this}},{key:"registerTerminal",value:function(e){return this.terminal=e,this}},{key:"runHandler",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map;return n.has("help")?this.showHelp():n.has("version")?this.showVersion():this.run(e,t,n)}},{key:"run",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map;return new Promise((function(r){e.write("Run command with ".concat(n," ").concat(i," ").concat(t)),r({input:t,args:n,options:i})}))}},{key:"autocomplete",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new Map;return new Promise((function(r){e.write("Autocomplete command ".concat(e.name," with ").concat(n," ").concat(i," ").concat(t)),r({input:t,args:n,options:i})}))}},{key:"showHelp",value:function(){var e=this;return new Promise((function(t){e.writeText(e.help),t(e.help)}))}},{key:"showVersion",value:function(){var e=this;return new Promise((function(t){var n="Version: ".concat(e.version);e.write(n),t(n)}))}},{key:"write",value:function(e){this.terminal?this.terminal.write(e):console.log(e)}},{key:"append",value:function(e){this.terminal?this.terminal.append(e):console.log(e)}},{key:"writeln",value:function(e){this.write("".concat(e,"\n"))}},{key:"writeText",value:function(e){this.write(e.replace(/\r?\n|\r/g,"\n\r"))}},{key:"updateProcessManager",value:function(e){this.process=s.uN.updateProcess(this.process.pid,this,e)}}]),e}()},1024:(e,t,n)=>{n.d(t,{X:()=>o});var i=n(5671),r=n(3144),o=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"guest";(0,i.Z)(this,e),this.features={},this.environment={},this.prepare(t)}return(0,r.Z)(e,[{key:"feature",get:function(){return this.features}},{key:"PWD",get:function(){return this.environment.PWD}},{key:"OLDPWD",get:function(){return this.environment.OLDPWD}},{key:"USER",get:function(){return this.environment.USER}},{key:"HOME",get:function(){return this.environment.HOME}},{key:"setFeature",value:function(e,t){this.features[e]=t}},{key:"setEnv",value:function(e,t){this.environment[e]=t}},{key:"getEnv",value:function(e){return e.startsWith("$")?this.environment[e.substring(1)]:this.environment[e]}},{key:"setPWD",value:function(e){this.environment.PWD&&this.setEnv("OLDPWD",this.environment.PWD),this.setEnv("PWD",e)}},{key:"getPath",value:function(){var e=this.environment.PATH;return e?e.split(":"):null}},{key:"prepare",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"guest";return new Promise((function(n){console.log("Gathering system information ..."),e.setFeature("serviceWorker","serviceWorker"in navigator),console.log("Detected Features",e.feature),e.setEnv("HOME","/home/".concat(t)),e.setEnv("LANG",navigator.language||"en-EN"),e.setEnv("OLDPWD",""),e.setEnv("PATH","/sbin:/bin"),e.setEnv("PWD","/home/".concat(t)),e.setEnv("SHELL","/bin/shell"),e.setEnv("TERM","xterm-256color"),e.setEnv("USER","".concat(t)),console.log("Detected Environment",e.environment),n()}))}}]),e}()},2960:(e,t,n)=>{n.r(t),n.d(t,{Kernel:()=>G,kernel:()=>J});var i=n(5671),r=n(3144),o=n(1024),s=n(5861),u=n(4687),l=n.n(u),a=function(){function e(){(0,i.Z)(this,e)}return(0,r.Z)(e,null,[{key:"blobToText",value:function(e){return"function"==typeof e.text?e.text():new Promise((function(t){var n=new FileReader;n.onload=function(){t(n.result)},n.readAsText(e)}))}},{key:"blobToBase64",value:function(t){return new Promise((function(n){e.blobToText(t).then((function(e){n(btoa(e))}))}))}},{key:"blobToStream",value:function(e){return e.stream()}},{key:"toBlob",value:function(t){return t instanceof Blob?t:"string"==typeof t&&t.startsWith("data:")?e.dataURLToBlob(t):"string"==typeof t?new Blob([t],{type:"text/plain"}):"number"==typeof t?new Blob([String(t)],{type:"text/plain"}):"function"==typeof t?new Blob([t.toString()],{type:"application/x-binary"}):new Blob}},{key:"dataURLToBlob",value:function(t){var n=t.replace(";base64","").split(","),i=n[0].split(":")[1].split(",")[0];return t.includes(";base64")?e.base64ToBlob(n[1],i):e.urlEncodedToBlob(n[1],i)}},{key:"urlEncodedToBlob",value:function(t,n){return new Blob([e.textToArrayBuffer(decodeURIComponent(t))],{type:n})}},{key:"base64ToBlob",value:function(t,n){var i="";try{i=atob(t)}catch(e){console.error("Decoding error for",t,e),i=t}return new Blob([e.textToArrayBuffer(i)],{type:n})}},{key:"textToArrayBuffer",value:function(e){return(new TextEncoder).encode(e)}},{key:"arrayBufferToText",value:function(e){return(new TextDecoder).decode(new Uint8Array(e))}}]),e}(),c=function(){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"unnamed",o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,i.Z)(this,e),this.data=a.toBlob(n),this.executable="function"==typeof n?n:void 0,this.id=(t="",window.crypto.getRandomValues(new Uint32Array(4)).forEach((function(e){t+="-"+e.toString(16)})),t.substr(1)),this.filename=r,this.options=o,this.lastModifiedDate=Date.now(),this.version=1}var t,n;return(0,r.Z)(e,[{key:"size",get:function(){return this.data.size||0}},{key:"name",get:function(){return this.filename}},{key:"type",get:function(){return this.data.type}},{key:"lastModified",get:function(){return this.lastModifiedDate}},{key:"getId",value:function(){return this.id}},{key:"getName",value:function(){return this.name}},{key:"getData",value:function(){return this.data}},{key:"getExecutable",value:function(){return this.executable}},{key:"setData",value:function(e){return"function"==typeof e&&(this.executable=e),this.data=a.toBlob(e),this.lastModifiedDate=Date.now(),this}},{key:"setName",value:function(e){this.filename=e}},{key:"getAsStream",value:function(){return a.blobToStream(this.data)}},{key:"getAsDataURL",value:function(){return""}},{key:"getAsExecutable",value:function(){var e=this;return new Promise((function(t){t(e.executable)}))}},{key:"getAsText",value:function(){return a.blobToText(this.data)}},{key:"getAsBinary",value:function(){var e=this;return new Promise((function(t){t(e.data)}))}},{key:"getAsBase64",value:function(){return a.blobToBase64(this.data)}},{key:"getObject",value:(n=(0,s.Z)(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getAsText();case 2:return t=e.sent,e.abrupt("return",{data:t,id:this.id,modified:this.lastModifiedDate,name:this.name,size:this.size,type:this.type,version:this.version});case 4:case"end":return e.stop()}}),e,this)}))),function(){return n.apply(this,arguments)})},{key:"getJSON",value:(t=(0,s.Z)(l().mark((function e(){var t;return l().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getObject();case 2:return t=e.sent,e.abrupt("return",JSON.stringify(t,null,2));case 4:case"end":return e.stop()}}),e,this)}))),function(){return t.apply(this,arguments)})}]),e}(),h=n(414),f="base64",v="binary",d="executable",y="stream",m="text",g=function(){function e(){(0,i.Z)(this,e),this.dirs={"/":{___files___:{}}},this.files=new Map,this.size=0}return(0,r.Z)(e,[{key:"addFolder",value:function(e){if(!e.startsWith("/"))throw new Error("Folder path needs to start with /");if("/"==e)throw new Error("Folder / is reserved for root!");if(this.existFolder(e))throw new Error("Folder "+e+" already exist!");if(this.existFile(e))throw new Error("File "+e+" already exist!");var t=h.y.basename(e);if("___files___"==t)throw new Error("Folder ___files___ is reserved for internal usage!");e.lastIndexOf("/")<=0?this.getRoot()[t]={___files___:{}}:this.getParentPath(e,!0)[t]={___files___:{}}}},{key:"exist",value:function(e){return!!this.existFolder(e)||!!this.existFile(e)}},{key:"existFolder",value:function(e){return!!h.y.findPathInObject(e,this.dirs)}},{key:"existFile",value:function(e){var t=this.getParentPath(e);return t&&h.y.basename(e)in t.___files___}},{key:"readFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{type:m},n=this.getFile(e);switch(t.type){case y:return n.getAsStream();case f:return n.getAsBase64();case v:return n.getAsBinary();case d:return n.getAsExecutable();default:return n.getAsText()}}},{key:"writeFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{overwrite:!0,append:!1};if(!e.startsWith("/"))throw new Error("File path needs to start with /");if("/"==e)throw new Error("File / is reserved for root!");if(this.existFolder(e))throw new Error("Folder "+e+" already exist!");if(this.existFile(e)){if(!n.overwrite)throw new Error("File "+e+" already exist!");return this.getFile(e).setData(t)}var i=h.y.basename(e),r=new c(t,i);return e.lastIndexOf("/")<=0?(this.getRoot().___files___[i]=r.getId(),this.files.set(r.getId(),r)):(this.getParentPath(e,!0).___files___[i]=r.getId(),this.files.set(r.getId(),r)),r}},{key:"listFiles",value:function(e){return this.existFolder(e)?h.y.findPathInObject(e,this.dirs).___files___:this.existFile(e)?this.getParentPath(e,!0).___files___:null}},{key:"getFile",value:function(e){if(!this.existFile(e))throw new Error("No such file or directory: "+e);var t=this.getParentPath(e).___files___[h.y.basename(e)];return this.files.get(t)}},{key:"getFileById",value:function(e){if(!this.files.has(e))throw new Error("No such file with id "+e);return this.files.get(e)}},{key:"listFolders",value:function(e){var t=null;if(this.existFolder(e))t=h.y.findPathInObject(e,this.dirs);else{if(!this.existFile(e))return null;t=this.getParentPath(e,!0)}if(t){var n=Object.assign({},t);return delete n.___files___,n}return null}},{key:"getParentPath",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=h.y.findPathInObject(h.y.dirname(e),this.dirs);if(!n&&t)throw new Error("Missing parent folder "+h.y.dirname(e)+" for "+e);return n}},{key:"getRoot",value:function(){return this.dirs["/"]}}]),e}(),p=n(4942),k={exec:!0,nouser:!0,readwrite:!0};function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function b(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,p.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=function(){function e(t,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};(0,i.Z)(this,e),this.path=t,this.target=n,this.options=b(b({},k),r)}return(0,r.Z)(e,[{key:"executeCommand",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";return this.getCommand(e)(t,n)}},{key:"getOptions",value:function(){return this.options}},{key:"setOptions",value:function(e){console.log("Changing mount options for",this.path,"to",e),this.options=b(b({},this.options),{},{options:e})}},{key:"getTarget",value:function(){return this.target}},{key:"getCommand",value:function(e){if("function"!=typeof this.target[e])throw new Error("No mount point handler defined for command: "+e);return this.target[e].bind(this.target)}},{key:"executeFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.options.exec)throw new Error("Permission denied");return this.getCommand("executeFile")(e,t,n)}},{key:"existFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getCommand("existFile")(e,t)}},{key:"readFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getCommand("readFile")(e,t)}},{key:"getFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getCommand("getFile")(e,t)}},{key:"writeFile",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!this.options.readwrite)throw new Error("Permission denied");return this.getCommand("writeFile")(e,t,n)}},{key:"listFiles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getCommand("listFiles")(e,t)}},{key:"existFolder",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getCommand("existFolder")(e,t)}},{key:"listFolders",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.getCommand("listFolders")(e,t)}},{key:"mkdir",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.options.readwrite)throw new Error("Permission denied");return this.getCommand("addFolder")(e,t)}},{key:"rmdir",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.options.readwrite)throw new Error("Permission denied");return this.getCommand("removeFolder")(e,t)}},{key:"getPath",value:function(e){var t="";if(e==this.path?t="/":e.startsWith(this.path)&&(t=e.substring(this.path.length)),!t)throw new Error("Unable to resolve target path for ".concat(e," within ").concat(this.path));return t}}]),e}(),x=function(){function e(){(0,i.Z)(this,e),this.mounts={}}return(0,r.Z)(e,[{key:"mount",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new g,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!e.startsWith("/"))throw new Error("Mount point needs to start with /");if("/"==e)throw new Error("Mount point / is already reserved for root!");if(this.exist(e))throw new Error("Mount point "+e+" already exist!");this.get(e)&&console.log("Mounting child ..."),this.mounts[e]=new P(e,t,n),console.log("Mounted",e,"to",this.mounts[e])}},{key:"umount",value:function(e){console.log("Unmount mount point",this.mounts[e],"for",e),delete this.mounts[e]}},{key:"remount",value:function(e,t){this.mounts[e].setOptions(t)}},{key:"mkdir",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getMount(e);return n?n.mkdir(n.getPath(e),t):Promise.reject(new Error("No valid mount point for "+e))}},{key:"readFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getMount(e);return n?n.readFile(n.getPath(e),t):Promise.reject(new Error("No valid mount point for "+e))}},{key:"existFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.get(e);if(n){var i=n.getPath(e);return n.existFile(i,t)}return!1}},{key:"getFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getMount(e);if(n){var i=n.getPath(e);return n.getFile(i,t)}return null}},{key:"writeFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=this.getMount(e);return i?i.writeFile(i.getPath(e),t,n):Promise.reject(new Error("No valid mount point for "+e))}},{key:"listFiles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("/"==e)return{};var n=this.get(e);if(n){var i=n.getPath(e);return n.listFiles(i,t)}return null}},{key:"existFolder",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.get(e);if(n){var i=n.getPath(e);return n.existFolder(i,t)}return!1}},{key:"listFolders",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("/"==e)return this.mounts;var n=this.get(e);if(n){var i=n.getPath(e);return n.listFolders(i,t)}return null}},{key:"exec",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",i=this.getMount(e);if(i){var r=i.getPath(e);return i.executeCommand(t,r,n)}return null}},{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=h.y.closest(e,Object.keys(this.mounts));if(t){if(!n)throw new Error("No available mount point for:"+e);if(!this.mounts[n].getTarget())throw new Error("Target for mount point "+n+" is not defined!")}return n?this.mounts[n]:null}},{key:"getMount",value:function(e){return this.get(e,!0)}},{key:"getTarget",value:function(e){var t=this.getMount(e);return t?t.getTarget():null}},{key:"exist",value:function(e){return e in this.mounts}},{key:"list",value:function(){return this.mounts}}]),e}(),F=function(){function e(){(0,i.Z)(this,e),this.mountPoint=new x}return(0,r.Z)(e,[{key:"mkdir",value:function(e){this.mountPoint.mkdir(e)}},{key:"mount",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0;this.mountPoint.mount(e,t)}},{key:"remount",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.mountPoint.remount(e,t)}},{key:"existFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.mountPoint.existFile(e,t)}},{key:"getFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.mountPoint.getFile(e,t)}},{key:"writeFile",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.mountPoint.writeFile(e,t,n)}},{key:"listFiles",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.mountPoint.listFiles(e,t)}},{key:"existFolder",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.mountPoint.existFolder(e,t)}},{key:"listFolders",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.mountPoint.listFolders(e,t)}},{key:"existMount",value:function(e){return this.mountPoint.exist(e)}}]),e}(),Z=n(669),E=n(136),_=n(2963),S=n(1120),O=n(1600);function R(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,S.Z)(e);if(t){var r=(0,S.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,_.Z)(this,n)}}var M=function(e){(0,E.Z)(n,e);var t=R(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,i.Z)(this,n),(e=t.call(this,r,o,"cd")).fileSystem=o?o.kernel.requestFileSystem():null,e}return(0,r.Z)(n,[{key:"run",value:function(){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];arguments.length>2&&void 0!==arguments[2]||new Map;return new Promise((function(n){if(t[0])if("/"==t[0])e.env.setPWD("/");else if("~"==t[0]||""==t[0])e.env.setPWD(e.env.HOME);else if("-"==t[0]&&e.env.OLDPWD)e.env.setPWD(e.env.OLDPWD);else{var i=t[0].startsWith("/")?t[0]:h.y.join(e.env.PWD,t[0]);"/"==i?e.env.setPWD("/"):e.fileSystem.existMount(i)||e.fileSystem.existFolder(i)?e.env.setPWD(i):e.fileSystem.existFile(i)?e.write("cd: '".concat(t[0],"': Not a directory")):e.write("cd: '".concat(t[0],"': No such file or directory"))}else e.env.setPWD(e.env.HOME);n()}))}}]),n}(O.g);function D(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,S.Z)(e);if(t){var r=(0,S.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,_.Z)(this,n)}}var T=function(e){(0,E.Z)(n,e);var t=D(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,i.Z)(this,n),t.call(this,e,r,"echo")}return(0,r.Z)(n,[{key:"run",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";arguments.length>2&&void 0!==arguments[2]||new Map;return new Promise((function(n){e.write(t.trim()),n()}))}}]),n}(O.g),B=n(9439);function W(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,S.Z)(e);if(t){var r=(0,S.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,_.Z)(this,n)}}var A=function(e){(0,E.Z)(n,e);var t=W(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,i.Z)(this,n),t.call(this,e,r,"env")}return(0,r.Z)(n,[{key:"run",value:function(){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];arguments.length>2&&void 0!==arguments[2]||new Map;return new Promise((function(n){if(!t[0])for(var i=0,r=Object.entries(e.env.environment);i<r.length;i++){var o=(0,B.Z)(r[i],2),s=o[0],u=o[1];e.write("".concat(s,"=").concat(u))}n()}))}}]),n}(O.g);function j(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,S.Z)(e);if(t){var r=(0,S.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,_.Z)(this,n)}}var I=function(e){(0,E.Z)(n,e);var t=j(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,i.Z)(this,n),t.call(this,e,r,"exit")}return(0,r.Z)(n,[{key:"run",value:function(){var e=this;arguments.length>2&&void 0!==arguments[2]||new Map;return new Promise((function(t){e.write("logout"),e.terminal&&e.terminal.close(),t()}))}}]),n}(O.g);function C(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,S.Z)(e);if(t){var r=(0,S.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,_.Z)(this,n)}}var N=function(e){(0,E.Z)(n,e);var t=C(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,i.Z)(this,n),(e=t.call(this,r,o,"ls")).fileSystem=o?o.kernel.requestFileSystem():null,e.help="Usage: ls [OPTION]... [FILE]...\n\n    --help     display this help and exit\n    --version  output version information and exit",e}return(0,r.Z)(n,[{key:"run",value:function(){var e=this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];arguments.length>2&&void 0!==arguments[2]||new Map;return new Promise((function(n){var i=t[0],r=e.list(i),o=r.fileList,s=r.folderList;if(console.log(o,s),null==o&&null==s)e.write("ls: cannot access '".concat(i,"': No such file or directory"));else{var u=e.formatList(o,s);u&&e.write(u)}n()}))}},{key:"list",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.env.PWD,t=e.startsWith("/")?e:h.y.join(this.env.PWD,e);return{fileList:this.fileSystem.listFiles(t),folderList:this.fileSystem.listFolders(t)}}},{key:"formatList",value:function(e,t){for(var n=[],i=0,r=Object.entries(t);i<r.length;i++){var o=(0,B.Z)(r[i],2),s=o[0];o[1];n.push("[1;34m".concat(s,"[0m"))}for(var u=[],l=0,a=Object.entries(e);l<a.length;l++){var c=(0,B.Z)(a[l],2),h=c[0];c[1];u.push(h)}return n.concat(u).join("\t")}}]),n}(O.g);function H(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,S.Z)(e);if(t){var r=(0,S.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,_.Z)(this,n)}}var L=function(e){(0,E.Z)(n,e);var t=H(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,i.Z)(this,n),t.call(this,e,r,"pwd")}return(0,r.Z)(n,[{key:"run",value:function(){var e=this;arguments.length>2&&void 0!==arguments[2]||new Map;return new Promise((function(t){e.write(e.env.PWD),t()}))}}]),n}(O.g);function U(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,S.Z)(e);if(t){var r=(0,S.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,_.Z)(this,n)}}var z=function(e){(0,E.Z)(n,e);var t=U(n);function n(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,i.Z)(this,n),t.call(this,e,r,"tty")}return(0,r.Z)(n,[{key:"run",value:function(){var e=this;arguments.length>2&&void 0!==arguments[2]||new Map;return new Promise((function(t){e.write("/dev/".concat(e.terminal.tty)),t()}))}}]),n}(O.g),q=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Z.uN;(0,i.Z)(this,e),this.process=n.registerProcess(this,t?t.process.pid:1e3),this.fileSystem=new F}return(0,r.Z)(e,[{key:"prepare",value:function(){var e=this;return new Promise((function(t){console.log("Preparing virtual file system with pid",e.process.pid),e.prepareTemps(),e.prepareSystemBinaries(),e.prepareHomes(),t(!0)}))}},{key:"prepareSystemBinaries",value:function(){this.fileSystem.mount("/sbin"),this.fileSystem.remount("/sbin",{readwrite:!1}),this.fileSystem.mount("/bin"),this.fileSystem.writeFile("/bin/cd",M),this.fileSystem.writeFile("/bin/echo",T),this.fileSystem.writeFile("/bin/env",A),this.fileSystem.writeFile("/bin/exit",I),this.fileSystem.writeFile("/bin/ls",N),this.fileSystem.writeFile("/bin/pwd",L),this.fileSystem.writeFile("/bin/tty",z)}},{key:"prepareHomes",value:function(){this.fileSystem.mount("/home"),this.fileSystem.mkdir("/home/guest"),this.fileSystem.mkdir("/home/guest/documents"),this.fileSystem.writeFile("/home/guest/README")}},{key:"prepareTemps",value:function(){this.fileSystem.mount("/tmp"),this.fileSystem.mkdir("/tmp/test1"),this.fileSystem.mkdir("/tmp/test2"),this.fileSystem.mkdir("/tmp/test3")}}]),e}(),X=function(){function e(){(0,i.Z)(this,e),this.memory={}}return(0,r.Z)(e,[{key:"add",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.memory[e]={value:t,time:n?(new Date).getTime()+1e3*n:0}}},{key:"get",value:function(e){return this.memory[e].time&&this.memory[e].time<=(new Date).getTime()?(this.delete(e),null):this.memory[e].value}},{key:"getSize",value:function(){return Object.keys(this.memory).length}},{key:"delete",value:function(e){delete this.memory[e]}}]),e}(),$=n(6145),V=n(6662),G=function(){function e(){(0,i.Z)(this,e),this.env=new o.X,this.process=Z.uN.registerProcess(this),this.fileSystem=new q(this),this.kernelMemory=new X,this.kernelMemory.add("tty",0),this.terminal=null,this.shell=null,this.version="0.1"}return(0,r.Z)(e,[{key:"boot",value:function(){var e=this;return new Promise((function(t){console.log("Preparing kernel with version",e.version,"..."),e.kernelMemory.add("boot_time",(new Date).getTime()),e.kernelMemory.add("hostname","codingwithchromne"),e.env.prepare(),e.fileSystem.prepare(),e.terminal=new V.o(e),e.shell=new $.N(void 0,e.terminal),t(!0)}))}},{key:"requestTty",value:function(){var e=Number(this.kernelMemory.get("tty")||0)+1;return this.kernelMemory.add("tty",e),"tty"+Number(e)}},{key:"requestFileSystem",value:function(){return this.fileSystem.fileSystem}},{key:"requestHostname",value:function(){return String(this.kernelMemory.get("hostname"))}}]),e}(),J=new G},669:(e,t,n)=>{n.d(t,{uN:()=>s});var i=n(3144),r=n(5671),o=(0,i.Z)((function e(t,n){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;(0,r.Z)(this,e),this.process=t,this.pid=n,this.ppid=i})),s=new(function(){function e(){(0,r.Z)(this,e),this.process={},this.lastPid=0}return(0,i.Z)(e,[{key:"registerProcess",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=this.lastPid+1;return this.process[n]=new o(e,n,t),this.lastPid=n,this.process[n]}},{key:"updateProcess",value:function(e,t,n){return this.process[e]=new o(t,e,n),this.process[e]}}]),e}())},6662:(e,t,n)=>{n.d(t,{o:()=>s});var i=n(5671),r=n(3144),o=n(669),s=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:o.uN;(0,i.Z)(this,e),this.kernel=t,this.tty=t?t.requestTty():100,this.prefix="vterm "+this.tty+":",this.process=n.registerProcess(this,t?t.process.pid:1e3),this.locked=!1,this.command=""}return(0,r.Z)(e,[{key:"writeResponse",value:function(e){console.log(this.prefix,e)}},{key:"lock",value:function(){this.locked=!0}},{key:"unlock",value:function(){this.locked=!1}}]),e}()},6145:(e,t,n)=>{n.d(t,{N:()=>d});var i=n(5671),r=n(3144),o=n(136),s=n(2963),u=n(1120),l=n(1600),a=n(1024),c=n(414);function h(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"==typeof e)return f(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return f(e,t)}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,s=!0,u=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){u=!0,o=e},f:function(){try{s||null==n.return||n.return()}finally{if(u)throw o}}}}function f(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}function v(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,i=(0,u.Z)(e);if(t){var r=(0,u.Z)(this).constructor;n=Reflect.construct(i,arguments,r)}else n=i.apply(this,arguments);return(0,s.Z)(this,n)}}var d=function(e){(0,o.Z)(n,e);var t=v(n);function n(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new a.X,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;return(0,i.Z)(this,n),(e=t.call(this,r,o,"shell")).fileSystem=o?o.kernel.requestFileSystem():null,e.tty=o?o.tty:1e3,e}return(0,r.Z)(n,[{key:"handleCommand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";console.log("Command",e,t);var n=this.getCommand(e);if(n){var i=this.handleInput(t),r=i.input,o=i.args,s=i.options;this.executeCommand(n,r,o,s)}else this.write(e+": command not found"),this.prompt()}},{key:"handleAutocomplete",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];console.log("Autocomplete",e,n,t);var i=this.getCommand(e);if(i){var r=this.handleInput(t),o=r.input,s=r.args;if(r.options&&!s)return;this.executeAutocomplete(i,o,s,n)}else e&&(console.log("Looking for command started with",e),i=this.getCommandStartedWith(e),console.log("Found possible command",i))}},{key:"handleInput",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",n=t;t.includes("$")&&(n=t.replace(/\$\w+/g,(function(t){return String(e.env.getEnv(t)||"")})));var i,r=new Map,o=[],s=h(n.split(/([^\s"]+|"[^"]*")+/g));try{for(s.s();!(i=s.n()).done;){var u=i.value;if(""===u.trim());else if(u.startsWith("--")){var l=u.split(/--(\w+)=?/);r.set(l[1],!u.includes("=")||l[2])}else o.push(u)}}catch(e){s.e(e)}finally{s.f()}return{input:n,args:o,options:r}}},{key:"getCommand",value:function(e){var t=this.env.getPath();if(!e||!this.fileSystem||!t)return null;var n,i=h(t);try{for(i.s();!(n=i.n()).done;){var r=n.value,o=c.y.join(r,e);if(this.fileSystem.existFile(o))return o}}catch(e){i.e(e)}finally{i.f()}return null}},{key:"getCommandStartedWith",value:function(e){var t=this.getCommand(e);if(t)return t;var n=this.env.getPath();if(!e||!this.fileSystem||!n)return null;var i,r=h(n);try{for(r.s();!(i=r.n()).done;){var o,s=i.value,u=h(this.fileSystem.listFiles(s));try{for(u.s();!(o=u.n()).done;){var l=o.value.split("/").pop();if(l&&l.includes(e))return l}}catch(e){u.e(e)}finally{u.f()}}}catch(e){r.e(e)}finally{r.f()}return null}},{key:"executeCommand",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new Map,o=this.fileSystem.getFile(e).getExecutable();if(o){this.terminal.lock();var s=new o(this.env,this.terminal);s.initHandler().runHandler(n,i,r).then((function(){t.terminal.unlock(),t.prompt()})).catch((function(e){t.writeln("".concat(s.name,": Runtime Error => ").concat(e)),console.error("".concat(s.name,":"),e),t.terminal.unlock(),t.prompt()}))}}},{key:"executeAutocomplete",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],o=this.fileSystem.getFile(e).getExecutable();if(o){this.terminal.lock();var s=new Map;s.set("doubleTab",r);var u=new o(this.env,this.terminal);u.autocomplete(n,i,s).then((function(){t.terminal.unlock(),t.prompt()})).catch((function(e){t.writeln("".concat(u.name,": Runtime Error => ").concat(e)),console.error("".concat(u.name,":"),e),t.terminal.unlock(),t.prompt()}))}}},{key:"registerTerminal",value:function(e){return console.log("Register terminal",e,"for",this.process.pid),this.terminal=e,this.tty||(this.tty=e.tty),e.process.pid&&this.updateProcessManager(e.process.pid),this}},{key:"registerFileSystem",value:function(e){console.log("Register fileSystem",e,"for",this.process.pid),this.fileSystem=e,this.env.getEnv("PATH")&&console.log("Adding search path",this.env.getEnv("PATH"))}},{key:"registerTty",value:function(e){console.log("Register tty",e,"for",this.process.pid),this.tty=e}},{key:"prompt",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this.terminal.kernel.requestHostname(),n=this.env.PWD;n.startsWith(this.env.HOME)&&(n=n.replace(this.env.HOME,"~")),this.write("[1;32m".concat(this.env.USER,"@").concat(t,"[0m:[1;34m").concat(n,"[0m$ ")),e&&this.write(e)}}]),n}(l.g)}}]);